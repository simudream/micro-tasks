!function(){"use strict";function a(a,b,c,d){this.opMethods=a,this.compareMethods=b,this.trace=c,this.sharedContext=d||{}}function b(){}function c(){}function d(a,b,c,d){this.opMethods=a,this.compareMethods=b,this.trace=c,this.sharedContext=d||{}}function e(){}function f(){}function g(){this.reset()}function h(){if(window.Promise)return window.Promise;throw new ReferenceError("Promise library could not be detected for this browser.")}function i(){if(window.promiseExtras)return window.promiseExtras;throw new ReferenceError("Promise-extras library could not be detected for this browser.")}function j(){l=o===!0?h():require("promise"),m=o===!0?i():require("promise-extras")}a.prototype={extract:function(a,b){var c=this;if(c.trace.reset(),void 0===a)throw new ReferenceError("Unspecified model dictionary.");if(void 0===b)throw new ReferenceError("Unspecified query.");var d=Object.keys(a),e={};return d.forEach(function(d,f){c.trace.stackLevel=0,c.trace.write(["$$extract",f]);var g=a[d],h=c.opMethods.executeQuery.call(c,g,b,!1);h===!0&&(e[d]=g)}),e},filter:function(a,b){var c=this;if(c.trace.reset(),void 0===a)throw new ReferenceError("Unspecified model array.");if(void 0===b)throw new ReferenceError("Unspecified query.");var d=[];return a.forEach(function(a,e){c.trace.stackLevel=0,c.trace.write(["$$filter",e]);var f=c.opMethods.executeQuery.call(c,a,b,!1);f===!0&&d.push(a)}),d},every:function(a,b){var c=this;if(c.trace.reset(),void 0===a)throw new ReferenceError("Unspecified model array.");if(void 0===b)throw new ReferenceError("Unspecified query.");return a.every(function(a,d){return c.trace.stackLevel=0,c.trace.write(["$$every",d]),c.opMethods.executeQuery.call(c,a,b,!1)})},one:function(a,b){var c=this;if(c.trace.reset(),void 0===a)throw new ReferenceError("Unspecified model.");if(void 0===b)throw new ReferenceError("Unspecified query.");return c.opMethods.executeQuery.call(c,a,b,!1)},some:function(a,b){var c=this;if(c.trace.reset(),void 0===a)throw new ReferenceError("Unspecified model array.");if(void 0===b)throw new ReferenceError("Unspecified query.");return a.some(function(a,d){return c.trace.stackLevel=0,c.trace.write(["$$some",d]),c.opMethods.executeQuery.call(c,a,b,!1)})}},b.prototype={$default:function(a,b){return b instanceof RegExp?this.compareMethods.$regexp(a,b):this.compareMethods.$equals(a,b)},$equals:function(a,b){return a===b},$length:function(a,b){return a.length==b},$regexp:function(a,b){return b.test(a)},$left:function(a,b){return a.substring(0,b.length)===b},$right:function(a,b){var c=a.length-b.length;return a.substring(c)===b},$typeof:function(a,b){return typeof a===b},$instanceof:function(a,b){return a instanceof b},$toLowerCase:function(a,b){return a.toLowerCase()===b},$toUpperCase:function(a,b){return a.toUpperCase()===b},$inArray:function(a,b){return-1!==b.indexOf(a)},$has:function(a,b){return b instanceof Array?b.every(function(b){return b in a}):b in a},$g:function(a,b){return a>b},$gte:function(a,b){return a>=b},$lte:function(a,b){return b>=a},$l:function(a,b){return b>a},$e:function(a,b){return a==b},$ne:function(a,b){return a!=b},$queryOne:function(a,b){return this.opMethods.executeQuery.call(this,a,b,!1)},$queryEvery:function(a,b){var c=this;return a.every(function(a){return c.opMethods.executeQuery.call(c,a,b,!1)})},$querySome:function(a,b){var c=this;return a.some(function(a){return c.opMethods.executeQuery.call(c,a,b,!1)})}},c.prototype={throwError:function(a){throw a},$and:function(a,b,c,d){return this.trace.write("$and"),this.opMethods.executeQuery.call(this,a,b,c,d)},$or:function(a,b,c,d){return this.trace.write("$or"),this.opMethods.executeQuery.call(this,a,b,c,d)},$not:function(a,b,c){var d=this.trace.stackLevel;this.trace.write("$not");var e=this.opMethods.executeQuery.call(this,a,b,!0,c);return this.trace.stack[d-1].result=e,e},executeCompare:function(a,b,c,d,e){this.trace.write(a);var f=this.compareMethods[a];if(void 0===f)return void e(new ReferenceError("No compare method was found for: "+a));var g=b[a],h=f.call(this,d,g);c&&(h=!h);var i=this.trace.stack;return i[i.length-1].result=h,h},executeValueOperations:function(a,b,c,d,e){this.trace.write(b);var f=a[b],g=c[b];return void 0===g?void e(new ReferenceError("No operation property was found for: "+b)):this.opMethods.executeQuery.call(this,a,g,d,f)},executeQuery:function(a,b,c,d){var e,f,g=this;void 0===c&&(c=!1),g.trace.stackLevel++,(b instanceof RegExp||"object"!=typeof b)&&(b={$default:b}),e=Object.keys(b),f="$or"in b,f===!0&&(e=e.filter(function(a){return"$or"!==a}));var h=e.every(function(e){var f=!1;return"$"===e[0]?(void 0===d&&(d=a),f="$not"===e?g.opMethods.$not.call(g,a,b.$not,d):"$and"===e?g.opMethods.$and.call(g,a,b.$and,c,d):g.opMethods.executeCompare.call(g,e,b,c,d,g.opMethods.throwError)):f=g.opMethods.executeValueOperations.call(g,a,e,b,c,g.opMethods.throwError),f});return 0===e.length&&(h=!1),f&&h===!1&&(h=g.opMethods.$or.call(g,a,b.$or,c,d)),g.trace.stackLevel--,h}},d.prototype={extract:function(a,b){var c=this;if(c.trace.reset(),void 0===a)return Promise.reject(new ReferenceError("Unspecified model dictionary."));if(void 0===b)return Promise.reject(new ReferenceError("Unspecified query."));var d=Promise.resolve({}),e=Object.keys(a);return e.forEach(function(e,f){d=d.then(function(d){c.trace.stackLevel=0,c.trace.write(["$$extract",f]);var g=a[e];return c.opMethods.executeQuery.call(c,g,b,!1).then(function(a){return a===!0&&(d[e]=g),d})})}),d},filter:function(a,b){var c=this;if(c.trace.reset(),void 0===a)return Promise.reject(new ReferenceError("Unspecified model array."));if(void 0===b)return Promise.reject(new ReferenceError("Unspecified query."));var d=Promise.resolve([]);return a.forEach(function(a,e){d=d.then(function(d){return c.trace.stackLevel=0,c.trace.write(["$$filter",e]),c.opMethods.executeQuery.call(c,a,b,!1).then(function(b){return b===!0&&d.push(a),d})})}),d},every:function(a,b){var c=this;return c.trace.reset(),void 0===a?Promise.reject(new ReferenceError("Unspecified model array.")):void 0===b?Promise.reject(new ReferenceError("Unspecified query.")):promiseExtras.every(a,function(a,d,e){c.trace.stackLevel=0,c.trace.write(["$$every",d]),e(c.opMethods.executeQuery.call(c,a,b,!1))})},one:function(a,b){var c=this;return c.trace.reset(),void 0===a?Promise.reject(new ReferenceError("Unspecified model.")):void 0===b?Promise.reject(new ReferenceError("Unspecified query.")):c.opMethods.executeQuery.call(c,a,b,!1)},some:function(a,b){var c=this;return c.trace.reset(),void 0===a?Promise.reject(new ReferenceError("Unspecified model array.")):void 0===b?Promise.reject(new ReferenceError("Unspecified query.")):promiseExtras.some(a,function(a,d,e){c.trace.stackLevel=0,c.trace.write(["$$some",d]),e(c.opMethods.executeQuery.call(c,a,b,!1))})}};var k=Object.create(b.prototype);k.$queryEvery=function(a,b){var c=this;return promiseExtras.every(a,function(a,d,e){e(c.opMethods.executeQuery.call(c,a,b,!1))})},k.$querySome=function(a,b){var c=this;return promiseExtras.some(a,function(a,d,e){e(c.opMethods.executeQuery.call(c,a,b,!1))})},e.prototype=k;var k=Object.create(c.prototype);k.executeQuery=function(a,b,c,d){var e,f,g=this;return void 0===c&&(c=!1),g.trace.stackLevel++,(b instanceof RegExp||"object"!=typeof b)&&(b={$default:b}),e=Object.keys(b),f="$or"in b,f===!0&&(e=e.filter(function(a){return"$or"!==a})),promiseExtras.every(e,function(e,f,h,i){var j=!1;"$"===e[0]?(void 0===d&&(d=a),j="$not"===e?g.opMethods.$not.call(g,a,b.$not,d):"$and"===e?g.opMethods.$and.call(g,a,b.$and,c,d):g.opMethods.executeCompare.call(g,e,b,c,d,i)):j=g.opMethods.executeValueOperations.call(g,a,e,b,c,i),h(j)}).then(function(h){return 0===e.length&&(h=!1),f&&h===!1&&(h=g.opMethods.$or.call(g,a,b.$or,c,d)),h}).then(function(a){return g.trace.stackLevel--,a})},f.prototype=k,g.prototype={reset:function(){this.stack=[],this.stackLevel=0},write:function(a){var b={level:this.stackLevel,operation:a};this.stack.push(b)}};var l,m,n,o="undefined"!=typeof window,p={get promise(){return void 0===n&&(j(),n=new d(new f,new e,new g)),n},sync:new a(new c,new b,new g),Query:a,QueryOperations:c,QueryStackTrace:g,get QueryPromise(){return void 0===n&&j(),d},get QueryPromiseOperations(){return void 0===n&&j(),f},get QueryPromiseComparisons(){return void 0===n&&j(),e}};"undefined"!=typeof window?window.querify=p:"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=p:exports=p}();
//# sourceMappingURL=querify.min.js.map